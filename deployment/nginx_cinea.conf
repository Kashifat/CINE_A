upstream backend_5001 { server 127.0.0.1:5001; }
upstream backend_5002 { server 127.0.0.1:5002; }
upstream backend_5003 { server 127.0.0.1:5003; }
upstream backend_5004 { server 127.0.0.1:5004; }
upstream backend_5005 { server 127.0.0.1:5005; }
upstream backend_5006 { server 127.0.0.1:5006; }
upstream backend_5007 { server 127.0.0.1:5007; }
upstream backend_5008 { server 127.0.0.1:5008; }
upstream backend_5009 { server 127.0.0.1:5009; }
upstream backend_5010 { server 127.0.0.1:5010; }
upstream backend_5011 { server 127.0.0.1:5011; }
upstream backend_5012 { server 127.0.0.1:5012; }

server {
    listen 80 default_server;
    listen [::]:80 default_server;
    
    server_name _;
    
    # Frontend React
    location / {
        root /home/ubuntu/CINE_A/Frontend/build;
        try_files $uri $uri/ /index.html;
    }
    
    # Chemins directs (compatibilit√©)
    location /contenus/ { proxy_pass http://backend_5002/contenus/; }
    
    # API reverse proxy
    location /api/utilisateurs/ { proxy_pass http://backend_5001/api/utilisateurs/; }
    location /api/films/ { proxy_pass http://backend_5002/api/films/; }
    location /api/paiement/ { proxy_pass http://backend_5003/api/paiement/; }
    location /api/admin/ { proxy_pass http://backend_5004/api/admin/; }
    location /api/historique/ { proxy_pass http://backend_5005/api/historique/; }
    location /api/avis/ { proxy_pass http://backend_5006/api/avis/; }
    location /api/publications/ { proxy_pass http://backend_5007/api/publications/; }
    location /api/reactions/ { proxy_pass http://backend_5008/api/reactions/; }
    location /api/commentaires/ { proxy_pass http://backend_5009/api/commentaires/; }
    location /api/notifications/ { proxy_pass http://backend_5010/api/notifications/; }
    location /api/tv/ { proxy_pass http://backend_5011/tv/; }
    location /api/chatbot/ { proxy_pass http://backend_5012/api/chatbot/; }
}
