# ==============================================
#  CONFIGURATION DE LA BASE DE DONN√âES CINEA
#  MariaDB + pymysql
#  
#  ‚ö†Ô∏è EXEMPLE - Copiez ce fichier en config.py
#  et modifiez les valeurs selon votre environnement
# ==============================================

import pymysql
import pymysql.cursors

# ----------------------------------------------
# PARAM√àTRES DE CONNEXION
# ----------------------------------------------
DB_HOST = "localhost"
DB_PORT = 3306
DB_USER = "root"
DB_PASSWORD = ""  # ‚ö†Ô∏è Mettez votre mot de passe MariaDB ici !
DB_NAME = "cinea"
DB_CHARSET = "utf8mb4"


# ----------------------------------------------
# FONCTION DE CONNEXION √Ä LA BASE
# ----------------------------------------------
def get_db_connection():
    """
    Retourne une connexion MariaDB (pymysql)
    Utilis√©e par tous les fichiers Python.
    """
    try:
        conn = pymysql.connect(
            host=DB_HOST,
            port=DB_PORT,
            user=DB_USER,
            password=DB_PASSWORD,
            database=DB_NAME,
            charset=DB_CHARSET,
            cursorclass=pymysql.cursors.DictCursor
        )
        return conn
    except Exception as e:
        print(f"‚ùå Erreur de connexion √† la base de donn√©es : {e}")
        return None


# ----------------------------------------------
# TEST DE CONNEXION
# ----------------------------------------------
if __name__ == "__main__":
    print("üîç Test de connexion √† la base de donn√©es...")
    conn = get_db_connection()
    
    if conn:
        print("‚úÖ Connexion r√©ussie !")
        
        # Test simple
        try:
            cur = conn.cursor()
            cur.execute("SELECT VERSION()")
            version = cur.fetchone()
            print(f"üìä Version MariaDB : {version['VERSION()']}")
            
            cur.execute("SELECT COUNT(*) as count FROM utilisateurs")
            nb_users = cur.fetchone()
            print(f"üë• Nombre d'utilisateurs : {nb_users['count']}")
            
            conn.close()
        except Exception as e:
            print(f"‚ùå Erreur lors du test : {e}")
    else:
        print("‚ùå √âchec de la connexion")
        print("\nüí° V√©rifiez :")
        print("   - MariaDB est d√©marr√©")
        print("   - Le mot de passe dans DB_PASSWORD est correct")
        print("   - La base de donn√©es 'cinea' existe")
